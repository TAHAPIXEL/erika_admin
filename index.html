<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูพูู ูุฏุฑุช ุขุฒููู - Erika Khosravi</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vazirmatn Font from Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap">
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        .bg-app { background-color: #ffffff; }
        .text-app { color: #000000; }
        .border-app { border-color: #000000; }
        .bg-input { background-color: #fafafa; }
        .btn-primary { 
            background-color: #000000; 
            color: #ffffff; 
        }
        .btn-primary:hover { background-color: #333333; }
        .en-text { 
            font-family: "Times New Roman", serif; 
            font-weight: bold; 
        }
        body { font-family: 'Vazirmatn', sans-serif; }
        
        .user-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .user-card:hover {
            border-color: #000000;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .user-card.selected {
            border-color: #000000;
            background-color: #f9fafb;
        }
        
        .correct-btn {
            background-color: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            margin: 4px;
            cursor: pointer;
        }
        
        .incorrect-btn {
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            margin: 4px;
            cursor: pointer;
        }
        
        .question-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .correct-answer {
            background-color: #d1fae5;
            border-color: #10b981;
        }
        
        .incorrect-answer {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #000000;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-app text-app min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-2">ูพูู ูุฏุฑุช ุขุฒููู</h1>
            <p class="en-text text-xl mb-4">Erika Khosravi - Admin Panel</p>
            <div class="flex justify-center mb-6">
                <div class="w-6 h-1 bg-black rounded-full"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Users List -->
            <div class="bg-white border-app border rounded-2xl shadow-md p-6">
                <h2 class="text-2xl font-bold mb-6 text-center">ูุณุช ุดุฑฺฉุชโฺฉููุฏฺฏุงู</h2>
                
                <!-- Search and Filters -->
                <div class="mb-6 space-y-4">
                    <input 
                        type="text" 
                        id="search-input"
                        placeholder="ุฌุณุชุฌู ุจุฑ ุงุณุงุณ ูุงูุ ุชููู ุง ุขุฏ ุชูฺฏุฑุงู..."
                        class="w-full p-3 border-app border rounded-lg bg-input focus:ring-2 focus:ring-black focus:border-black"
                    >
                    
                    <div class="flex gap-4">
                        <button id="filter-all" class="btn-primary px-4 py-2 rounded-lg text-sm flex-1">
                            ููู ฺฉุงุฑุจุฑุงู
                        </button>
                        <button id="filter-not-graded" class="bg-gray-500 text-white px-4 py-2 rounded-lg text-sm flex-1">
                            ุชุตุญุญ ูุดุฏู
                        </button>
                        <button id="filter-graded" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm flex-1">
                            ุชุตุญุญ ุดุฏู
                        </button>
                    </div>
                </div>

                <!-- Users Container -->
                <div id="users-container" class="space-y-4 max-h-[600px] overflow-y-auto">
                    <!-- Users will be loaded here -->
                </div>

                <!-- Loading State -->
                <div id="loading-users" class="text-center py-8">
                    <div class="spinner mx-auto"></div>
                    <p class="text-gray-600 mt-2">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ ฺฉุงุฑุจุฑุงู...</p>
                </div>
            </div>

            <!-- User Details and Grading -->
            <div class="bg-white border-app border rounded-2xl shadow-md p-6">
                <div id="no-user-selected" class="text-center py-12">
                    <div class="text-6xl mb-4">๐ค</div>
                    <h3 class="text-xl font-bold mb-2">ูฺ ฺฉุงุฑุจุฑ ุงูุชุฎุงุจ ูุดุฏู</h3>
                    <p class="text-gray-600">ูุทูุงู ฺฉ ฺฉุงุฑุจุฑ ุงุฒ ูุณุช ุณูุช ุฑุงุณุช ุงูุชุฎุงุจ ฺฉูุฏ</p>
                </div>

                <!-- User Exam Details -->
                <div id="user-exam-details" class="hidden">
<!-- User Info -->
<div class="bg-gray-50 rounded-lg p-4 mb-6">
    <h3 class="text-lg font-bold mb-3">ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <div>
            <span class="font-medium">ูุงู ู ูุงู ุฎุงููุงุฏฺฏ:</span>
            <span id="user-fullname">-</span>
        </div>
        <div>
            <span class="font-medium">ุดูุงุฑู ุชููู:</span>
            <span id="user-phone">-</span>
        </div>
        <div>
            <span class="font-medium">ุขุฏ ุชูฺฏุฑุงู:</span>
            <span id="user-telegram">-</span>
        </div>
        <div>
            <span class="font-medium">ุชุงุฑุฎ ุซุจุชโูุงู:</span>
            <span id="user-registered">-</span>
        </div>
        <!-- ุงุถุงูู ฺฉุฑุฏู ุฒูุงู ุดุฑูุน ุขุฒููู -->
        <div>
            <span class="font-medium">ุฒูุงู ุดุฑูุน ุขุฒููู:</span>
            <span id="exam-started-at">-</span>
        </div>
        <div>
            <span class="font-medium">ุฒูุงู ูพุงุงู ุขุฒููู:</span>
            <span id="exam-completed-at">-</span>
        </div>
    </div>
</div>

<!-- Exam Status -->
<div class="bg-blue-50 rounded-lg p-4 mb-6">
    <h3 class="text-lg font-bold mb-3">ูุถุนุช ุขุฒููู</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
        <div>
            <span class="font-medium">ุณูุงูุงุช ูพุงุณุฎ ุฏุงุฏู:</span>
            <span id="answered-count">0</span>
        </div>
        <div>
            <span class="font-medium">ุณูุงูุงุช ุจโูพุงุณุฎ:</span>
            <span id="unanswered-count">54</span>
        </div>
        <div>
            <span class="font-medium">ููุฑู ูุนู:</span>
            <span id="current-score">0</span>
        </div>
        <div>
            <span class="font-medium">ูุถุนุช ุชุตุญุญ:</span>
            <span id="grading-status" class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">ุชุตุญุญ ูุดุฏู</span>
        </div>
        <!-- ุงุถุงูู ฺฉุฑุฏู ูุฏุช ุฒูุงู ุขุฒููู -->
        <div class="md:col-span-2">
            <span class="font-medium">ูุฏุช ุฒูุงู ุขุฒููู:</span>
            <span id="exam-duration">-</span>
        </div>
    </div>
</div>

                    <!-- Questions and Grading -->
                    <div>
                        <h3 class="text-lg font-bold mb-4">ุชุตุญุญ ุณูุงูุงุช</h3>
                        <div class="mb-4 flex justify-between items-center">
                            <span class="text-sm text-gray-600">ุจุฑุง ูุฑ ุณูุงู ูพุงุณุฎ ุตุญุญ ุง ุบูุท ุฑุง ูุดุฎุต ฺฉูุฏ</span>
                            <button id="save-grades" class="btn-primary px-6 py-2 rounded-lg text-sm">
                                ุฐุฎุฑู ููุฑุงุช
                            </button>
                        </div>

                        <div id="questions-container" class="space-y-4 max-h-[500px] overflow-y-auto">
                            <!-- Questions will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const supabaseUrl = 'https://zuxnwivvhdknrsnelcio.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1eG53aXZ2aGRrbnJzbmVsY2lvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwOTk4MjUsImV4cCI6MjA3ODY3NTgyNX0.WxyqhPYudUH_yP_5RyiYhcVeF2_dp30SDg96Ost4Xp4';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Questions data - ุชูุงู 54 ุณูุงู
        const questions = [
            {
                id: 1,
                text: "ุงฺฏุฑ ฺฉุงุฑูุฑูุง ูุดฺฉู ุงุตูโุงุด ุฑุดุฏ ูพุฌุด ุจุงุดุฏ ฺู ุฌูุงูุจ ุฑุง ุฏุฑ ูุธุฑ ูโฺฏุฑุฏุ",
                type: "text"
            },
            {
                id: 2,
                text: "ฺู ฺุฒ ุจุงุนุซ ูโุดูุฏ ุฌูู ุฑุดุฏ ูพุฌ ฺฏุฑูุชู ุดูุฏุ",
                type: "text"
            },
            {
                id: 3,
                text: "ุจูุชุฑู ุฒูุงู ูพุณุช ฺฏุฐุงุฑุ",
                type: "multiple",
                options: [
                    "ุชุงู ฺฉู ุงูฺฏูุฑุชู ุงูุณุชุงฺฏุฑุงู ุฏุฑ ูุธุฑ ฺฏุฑูุชู.",
                    "ุชุงู ฺฉู ฺฉุงุฑูุฑูุง ุชุนู ฺฉูุฏ.",
                    "ุชุงู ฺฉู ุงุฏูู ุฏุฑ ูุธุฑ ุฏุงุฑุฏ.",
                    "ุชุงู ู ุณุงุนุช ุขูพููุฏ ููู ูุณุช."
                ]
            },
            {
                id: 4,
                text: "ููู ุชุฑู ุนุงูู ุณูุงุฑูููุณ ฺุณุชุ",
                type: "text"
            },
            {
                id: 5,
                text: "ฺฉุฏุงู ฺฏุฒูู ุฏุฑ ุฑุงุจุทู ุจุง ูุธุงู ุงุฏูู ุณูุงุฑูููุณ ุบูุท ุงุณุชุ",
                type: "multiple",
                options: [
                    "ููุดุชู ุณูุงุฑู ุจู ุตูุฑุช ฺฉุงูู.",
                    "ููุดุชู ุฌุฒุฆุงุช ุณูุงุฑู.",
                    "ฺุฏูุงู ุณุงุฎุชุงุฑ ุณูุงุฑู.",
                    "ูููุจุฑุฏุงุฑ ุงุฒ ูุญุชูุง ุณูุงุฑู."
                ]
            },
            {
                id: 6,
                text: "ุงฺฏุฑ ฺฉ ูพุณุช ุฏุฑ ุฒูุงู ูุง ุงููู (ฒด ุณุงุนุช ุงูู) ุขูพููุฏุ ูู ูุฏูุธุฑ ุฑุง ูฺฏุฑุฏ ุจูุชุฑู ฺฉุงุฑ ฺุณุชุ",
                type: "multiple",
                options: [
                    "ุญุฐู ูพุณุช.",
                    "ุขุฑุดู ูพุณุช.",
                    "ุชุจูุบ ููุฑ.",
                    "ุชุญูู ูพุณุช."
                ]
            },
            {
                id: 7,
                text: "ด ูุฏู ุงุตู ุงุณุชูุฑ ฺฏุฐุงุดุชู ุฑุง ุจฺฏูุฏ (ุจุฏูู ุชูุถุญ ููุท ฺฏูุชู ูุฏู)ุ",
                type: "text"
            },
            {
                id: 8,
                text: "ุจูุชุฑู ุชุนุฏุงุฏ ุงุณุชูุฑ ุฑูุฒุงูู ุจุฑุง ูพุฌ ูุง ุขููุฒุดุ",
                type: "multiple",
                options: [
                    "ณ ุชุง ถ ุงุณุชูุฑ.",
                    "ถ ุชุง ธ ุงุณุชูุฑ.",
                    "ฑฐ ุงู ฒฐ ู ุญุช ุจุดุชุฑ."
                ]
            },
            {
                id: 9,
                text: "ฺู ููุน ูุญุชูุง ุจุงุนุซ ูุฑูุฏ ฺฏุฑูุชู ุงุฒ ุงฺฉุณูพููุฑ ูโุดูุฏุ (ุจู ุตูุฑุช ฺฉูุชุงู ุชูุถุญ ุฏูุฏ)",
                type: "text"
            },
            {
                id: 10,
                text: "ฺุฑุง ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑูุง ุชุนุงูู ุฏุฑ ุงุณุชูุฑ ุงููุช ุฏุงุฑุฏุ",
                type: "text"
            },
            {
                id: 11,
                text: "ุชูุงูุช ูุญุชูุง ูพุณุช ู ุงุณุชูุฑ ุงุฒ ูุธุฑ ูุฏู ุชูุถุญ ุฏูุฏ.",
                type: "text"
            },
            {
                id: 12,
                text: "ุจุนุฏ ุงุฒ ุขูุงูุฒ ูุชุฑู ูพุฌ ุจุงุฏ ฺฉุฏุงู ฺฉ ุงุฒ ููุฑุฏูุง ุฒุฑ ุจุฑุฑุณ ุดูุฏุ",
                type: "multiple",
                options: [
                    "ุฑุดุฏ ูพุฌ.",
                    "ุชุจูุบุงุช ูพุฌ.",
                    "ุงุณุชูุฑ.",
                    "ูฺฺฉุฏุงู."
                ]
            },
            {
                id: 13,
                text: "ฺฉุฏุงู ุนุงูู ุจุดุชุฑู ุชุงุซุฑ ุฑุง ุฏุฑ ูุงุฑุงู ุดุฏู ุฑูุฒ ุฏุงุฑุฏุ",
                type: "multiple",
                options: [
                    "ฺฉูุช ูููุจุฑุฏุงุฑ - ุชุงู ุฑูุฒ.",
                    "ุงุณุชูุงุฏู ุงุฒ ุขููฺฏ ุชุฑูุฏ.",
                    "ูุงุฒุณุงุฒ ููุซุฑ.",
                    "ุณูุงุฑู."
                ]
            },
            {
                id: 14,
                text: "ุจูุชุฑู ุฒูุงู ุจุฑุง ุขูพููุฏ ูพุณุช ฺฉุฏุงู ุชุงู ุงุณุชุ",
                type: "multiple",
                options: [
                    "ุฑูุฒ.",
                    "ุดุจ.",
                    "ูฺฺฉุฏุงู."
                ]
            },
            {
                id: 15,
                text: "ุฏุฑ ุงุณุชุฑุงุชฺ ุฑูุฒุ ุซุงูู ุงูู ฺู ุงุณู ุฏุงุฑุฏุ ููู ุงุณุชุ",
                type: "multiple",
                options: [
                    "ฺฉุงู ุชู ุงฺฉุดู - ุฎุฑ.",
                    "ฺฉุงู ุชู ุงฺฉุดู - ุจูู.",
                    "ููุงุจ - ุจูู.",
                    "ููุงุจ - ุฎุฑ."
                ]
            },
            {
                id: 16,
                text: "ุงฺฏุฑ ุฑูุฒ ูพุฌ ุจุงุฒุฏุฏ ฺฉู ุจฺฏุฑุฏุ ุดูุง ุฏุฑ ุฌุงฺฏุงู ุงุฏูู ฺู ุงูุฏุงู ุงูุฌุงู ูโุฏูุฏุ",
                type: "text"
            },
            {
                id: 17,
                text: "ุชูุงูุช ุฑูุฒ ุขููุฒุด ู ุชุจูุบุงุช ุงุฒ ูุธุฑ ูุฏู ู ุณุงุฎุชุงุฑ ุชูุถุญ ุฏูุฏ.",
                type: "text"
            },
            {
                id: 18,
                text: "ูุฏู ุงุตู ุงุฒ ูพุงุณุฎโุฏู ุจู ุฏุงุฑฺฉุช ูุง ฺุณุชุ",
                type: "text"
            },
            {
                id: 19,
                text: "ุงฺฏุฑ ุฏุฑ ฺฉ ูููุนุชุ ุจุงุฒุฎูุฑุฏ ู ูพุงู ููู ุงุฒ ฺฉุงุฑุจุฑุงู ูพุฌ ุง ูพูุชูุฑู ุชูฺฏุฑุงู ุฏุฑุงูุช ฺฉูุฏุ ุงููู ุงูุฏุงู ฺุณุชุ (ูพุงุณุฎ ฺฉูุชุงู)",
                type: "text"
            },
            {
                id: 20,
                text: "ููฺฏุงู ุฌูุงุจ ุฏุงุฏู ุจู ฺฉุงููุช ูุง ุจุงุฏ ฺุทูุฑ ุจุฑุฎูุฑุฏ ฺฉุฑุฏุ",
                type: "text"
            },
            {
                id: 21,
                text: "ุจูุชุฑู ุฑูุด ุจุฑุง ุฌูุงุจ ุฏุงุฏู ุจู ูุดุชุฑ ฺฉู ุฏู ุฏู ูุณุช ูููุน ุฎุฑุฏ ฺุณุชุ",
                type: "text"
            },
            {
                id: 22,
                text: "ุจูุชุฑู ุฑูุด ูุชูุงุนุฏ ฺฉุฑุฏู ูุดุชุฑ ฺู ุฑูุด ูุณุชุ (ูพุงุณุฎ ฺฉูุชุงู)",
                type: "text"
            },
            {
                id: 23,
                text: "ุขุง ุจู ุงุฏูู ุฏุงุฑฺฉุช ูุฑูุด ู ุงุฏูู ุฏุงุฑฺฉุช ฺฉู ูุธููโุงุด ุชุนุงูู ุงุณุช ูุฑู ูุณุชุ",
                type: "multiple",
                options: [
                    "ุจูู.",
                    "ุฎุฑ."
                ]
            },
            {
                id: 24,
                text: "ุงฺฏุฑ ูพุฌ ฺฉุงุฑูุฑูุง ุจุนุฏ ุงุฒ ุขูุงูุฒ ฺฉู ูุงุฒ ุฏุงุดุช ฺฉู ูุฑูุด ุง ุฑุดุฏ ูพุฌ ุฑุง ุงุฏ ุจฺฏุฑุฏุ ุขุง ุงุฏูู ุขูุงูุฒ ุจุงุฏ ุฏุฑ ุฑุงุจุทู ุจุง ุขู ูุดฺฉู ุจู ุขูโูุง ูุดุงูุฑู ุจุฏูุฏุ (ูพุงุณุฎ ฺฉูุชุงู)",
                type: "text"
            },
            {
                id: 25,
                text: "ุณุงุฎุชุงุฑ ุงุตูู ุณูุงุฑู ุฑุง ุชูุถุญ ุฏูุฏ.",
                type: "text"
            },
            {
                id: 26,
                text: "ุณุงุฎุชุงุฑ ุงุตูู ุณูุงุฑู ุงุณุชูุฑ ุฑุง ุชูุถุญ ุฏูุฏ.",
                type: "text"
            },
            {
                id: 27,
                text: "ฺู ฺฉุงุฑูุง ู ุงูุฏุงูุงุช ุจุงุนุซ ุฑุดุฏ ูุฑูุด ูโุดูุฏุ",
                type: "text"
            },
            {
                id: 28,
                text: "ุจุฑุง ุงูฺฉู ุฏุฑ ุงูุณุชุงฺฏุฑุงู ุณุฑุน ุชุฑ ุฑุดุฏ ฺฉูู ฺฉุฏุงู ููุฑุฏ ุชุตูู ุนุงููุงูู ุชุฑ ุงุณุชุ",
                type: "multiple",
                options: [
                    "ุชุจูุบุงุช.",
                    "ูุญุชูุง.",
                    "ูฺฺฉุฏุงู."
                ]
            },
            {
                id: 29,
                text: "ุจุฑุง ุฑูุฒ ฺฉู ุขูพููุฏ ูโฺฉูู ูุงุฒ ุงุณุช ูุจูุด ุฏุฑ ุงุณุชูุฑ ุงูุฏุงูุงุช ุตูุฑุช ุจฺฏุฑุฏุ (ุจุฑุง ุจูู ุง ุฎุฑ ุชูุถุญ ุฏูุฏ)",
                type: "text"
            },
            {
                id: 30,
                text: "ฺฉุฏุงู ุจุงุนุซ ุฑุดุฏ ูพุฌ ูโุดูุฏ:",
                type: "multiple",
                options: [
                    "ูุฏุงู ุงุณุชูุฑ ฺฏุฐุงุดุชู.",
                    "ูุนุงูุช ุงุตูู.",
                    "ูุญุชูุง ููุงุณุจ.",
                    "ูฺฺฉุฏุงู."
                ]
            },
            {
                id: 31,
                text: "ุฏุฑ ฺฉ ุณูุงุฑู ููุงุณุจุ ุจูุชุฑู ุจุฎุด ุจุฑุง ุฌูุจ ุชูุฌู ูุฎุงุทุจ ฺฉุฏุงู ุงุณุชุ",
                type: "multiple",
                options: [
                    "ุซุงูู ูุง ูพุงุงู.",
                    "ุซุงูู ูุง ูุงู.",
                    "ฺฉูพุดู ูุฏู.",
                    "ูฺฺฉุฏุงู."
                ]
            },
            {
                id: 32,
                text: "ุฏุฑ ุณูุงุฑููุง ุขููุฒุด ุจูุชุฑู ุฑูุด ุงูุชูุงู ุจู ุจููุฏู ฺุณุชุ",
                type: "multiple",
                options: [
                    "ููุท ุชูุถุญ ุขููุฒุดุงุช.",
                    "ููุงุด ฺฉ ูุซุงู.",
                    "ฺฏูุชู ุงุทูุงุนุงุช ูพุดุช ุณุฑ ูู.",
                    "ููุดุชู ูุชู ุฑู ูุฏู."
                ]
            },
            {
                id: 33,
                text: "ุงฺฏุฑ ูุฏู ุณูุงุฑู ูุฑูุด ูุญุตูู ุจุงุดุฏ ฺู ูฺฉุชู ูุง ุจุงุฏ ุงุฌุฑุง ุดูุฏุ",
                type: "text"
            },
            {
                id: 34,
                text: "ณ ููููู ููุงุจ ุจุฑุง ูพุฌ ูุฑูุด ูุจุงุณ ุจุฏูุฏ (ูุจุงุณ ุฏุฎุชุฑุงูู).",
                type: "text"
            },
            {
                id: 35,
                text: "ฺฉ ุณูุงุฑู ุฑูุฒ ฺฉูุชุงู ุจุฑุง ูพุฌ ูุฑูุด ฺฉู ุจููุณุฏ.",
                type: "text"
            },
            {
                id: 36,
                text: "ฺฉูพุดู ููุซุฑ ุจุงุฏ ฺู ูฺฺฏ ุฏุงุดุชู ุจุงุดุฏุ",
                type: "text"
            },
            {
                id: 37,
                text: "ฺฉุฏุงู ููุฑุฏ ุฏุฑ ุฑุงุจุทู ุจุง ูุงุฑุงู ุดุฏู ุฑูุฒ ููุซุฑ ูุณุชุ",
                type: "multiple",
                options: [
                    "ุงุณุชูุงุฏู ุงุฒ ฺฉูพุดู.",
                    "ุงูุชุดุงุฑ ุฏุฑ ุณุงุนุช ููุงุณุจ.",
                    "ฺฉูุช ูุญุชูุง.",
                    "ฺฉุงูุฑ."
                ]
            },
            {
                id: 38,
                text: "ุขุง ุจุงุฏ ุชูุงู ูพุณุช ูุง ูพุฌ ฺฉ ููุงุฎุช ู ุฏุฑ ฺฉ ูุงูุจ ู ูุฏู ุจุงุดูุฏุ ุง ุฏุฑ ููุถูุนุงุช ูุฎุชููุ (ุฌูุงุจ ุฎูุฏ ุฑุง ุชูุถุญ ุฏูุฏ)",
                type: "text"
            },
            {
                id: 39,
                text: "ูุฑุญูู ุจู ูุฑุญูู ุขูุงูุฒ ฺฉ ูพุฌ ุฑุง ุชูุถุญ ุฏูุฏ.",
                type: "text"
            },
            {
                id: 40,
                text: "ุขุง ุฌูุงุจ ุฏุงุฏู ุจู ุจุงุฒุฎูุฑุฏูุง ููู ุฏุฑ ฺฉ ูพุฌ ูุฑูุดฺฏุงู ููู ุงุณุชุ",
                type: "multiple",
                options: [
                    "ุจูู.",
                    "ุฎุฑ."
                ]
            },
            {
                id: 41,
                text: "ด ููุฑุฏ ุงุฒ ูุฏู ุงุตู ุงุณุชูุฑ ฺฏุฐุงุดุชู ุฑุง ุจุงู ฺฉูุฏ.",
                type: "text"
            },
            {
                id: 42,
                text: "ฺฉุฏุงู ุงุจุฒุงุฑ ุงุฒ ุงุณุชูุฑ ุจุงุนุซ ูุงุฑฺฉุชูฺฏ ุฏุฑ ูพุฌ ูโุดูุฏุ",
                type: "multiple",
                options: [
                    "ุงุณุชูุงุฏู ุงุฒ ุงุณุชฺฉุฑูุง ุชุนุงูู.",
                    "ท ุชุง ุงุณุชูุฑ ุฑูุฒุงูู ูุชููุน.",
                    "ุจุง ฺูุฑู ูุนุงูุช ฺฉุฑุฏู.",
                    "ุงุณุชูุฑ ฺฏุฐุงุดุชู ุจู ุตูุฑุช ูุชุฏุงูู."
                ]
            },
            {
                id: 43,
                text: "ฺูุฏ ุงูุฏุงู ุจุฑุง ุจุงูุง ุจุฑุฏู ูู ุงุณุชูุฑ ุจฺฏูุฏ.",
                type: "text"
            },
            {
                id: 44,
                text: "ณ ุงุฏู ุจุฑุง ุงุณุชูุฑ ูพุฌ ูุฑูุด ูุจุงุณุ *ููุท ูุฏู ุงุณุชูุฑ ฺฏูุชู ุดูุฏ.",
                type: "text"
            },
            {
                id: 45,
                text: "ุขุง ุชุนุงูู ุณุงุนุช ูุดุฎุต ุฏุงุฑุฏุ",
                type: "multiple",
                options: [
                    "ุจูู.",
                    "ุฎุฑ."
                ]
            },
            {
                id: 46,
                text: "ุขุง ุชุนุงูู ฺฉุฑุฏู ุฑู ุฑุดุฏ ูพุฌ ุชุงุซุฑ ุฏุงุฑุฏุ (ุชูุถุญ ุฏูุฏ)",
                type: "text"
            },
            {
                id: 47,
                text: "ุจูุชุฑู ุฑูุด ุชุจูุบ ุฑุง ุชูุถุญ ุฏูุฏ.",
                type: "text"
            },
            {
                id: 48,
                text: "ด ูุฏู ุงุตู ุชุจูุบุงุช ุฑุง ุชูุถุญ ุฏูุฏ.",
                type: "text"
            },
            {
                id: 49,
                text: "ุชุตูุฑ ฺฉูุฏ ูุฑุงุฑ ุงุณุช ุจู ุฏู ุชุง ุจูุงฺฏุฑ ุชุจูุบ ุจุฏูุฏ. ูุฑ ุฏู ตฐฐ ฺฉุง ูุงููุฑ ุฏุงุฑูุฏ. ุดูุง ูููุน ุงูุชุฎุงุจ ุจูุงฺฏุฑ ุจู ฺู ฺุฒูุง ุชูุฌู ูโฺฉูุฏุ ูุฑ ุฏู ุจูุงฺฏุฑ ุฑุง ุชูุถุญ ุฏูุฏ.",
                type: "text"
            },
            {
                id: 50,
                text: "ุงฺฏุฑ ุจุฎูุงูุฏ ุจู ฺฉ ููุฑ ุชุจูุบ ุจุฏูุฏ ุจู ฺู ฺุฒูุง ุชูุฌู ูโฺฉูุฏุ",
                type: "text"
            },
            {
                id: 51,
                text: "ุฏุฑ ุชุจูุบุงุช ุจูุงฺฏุฑูุง ฺฉุฏุงู ููุซุฑุชุฑ ุงุณุชุ",
                type: "multiple",
                options: [
                    "ฺฏูุด.",
                    "ุจูุฑ.",
                    "ุญุถูุฑ."
                ]
            },
            {
                id: 52,
                text: "ฺู ุงููุงู ูุง ุฏุฑ ุชุจูุบ ุจุงุนุซ ุงูุฒุงุด ุงุนุชูุงุฏ ูุฎุงุทุจ ูโุดูุฏุ",
                type: "text"
            },
            {
                id: 53,
                text: "ุขุง ุจุง ฺฉ ูพุฌ ุตูุฑ ุง ุญุฏุงูู ณฐฐ - ดฐฐ ุชุง ุฑูุด ุฏุฑุณุช ุงุณุช ุชุจูุบ ุฏุงุฏูุ",
                type: "multiple",
                options: [
                    "ุจูู.",
                    "ุฎุฑ."
                ]
            },
            {
                id: 54,
                text: "ุจุฑุง ุงูฺฉู ุจุชูุงูู ูุญุตูู ุฑุง ุจูุฑูุดู (ุญุช ุจู ณ - ด ุชุง ูุดุชุฑ! ู ุญุช ฑ - ฒ ุชุง ูุดุชุฑ) ุจุงุฏ ฺู ฺฉุงุฑูุง ุงูุฌุงู ุฏููุ",
                type: "text"
            }
        ];

        let allUsers = [];
        let selectedUser = null;
        let userAnswers = [];
        let correctedAnswers = Array(54).fill(null); // null: ุชุตุญุญ ูุดุฏู, true: ุตุญุญ, false: ุบูุท

        // DOM elements
        const usersContainer = document.getElementById('users-container');
        const loadingUsers = document.getElementById('loading-users');
        const noUserSelected = document.getElementById('no-user-selected');
        const userExamDetails = document.getElementById('user-exam-details');
        const questionsContainer = document.getElementById('questions-container');
        const searchInput = document.getElementById('search-input');
        const saveGradesBtn = document.getElementById('save-grades');

        // Load all users
        async function loadUsers() {
            try {
                loadingUsers.classList.remove('hidden');
                usersContainer.innerHTML = '';

                const { data: users, error } = await supabase
                    .from('users')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allUsers = users || [];
                displayUsers(allUsers);
                
            } catch (error) {
                console.error('Error loading users:', error);
                alert('ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ฺฉุงุฑุจุฑุงู');
            } finally {
                loadingUsers.classList.add('hidden');
            }
        }

// Display users in the list
function displayUsers(users) {
    usersContainer.innerHTML = '';

    if (users.length === 0) {
        usersContainer.innerHTML = `
            <div class="text-center py-8 text-gray-500">
                ฺฉุงุฑุจุฑ ุงูุช ูุดุฏ
            </div>
        `;
        return;
    }

    users.forEach(user => {
        const userCard = document.createElement('div');
        userCard.className = 'user-card';
        userCard.innerHTML = `
            <div class="flex justify-between items-start">
                <div class="flex-1">
                    <h4 class="font-bold text-lg">${user.full_name}</h4>
                    <div class="text-sm text-gray-600 mt-1">
                        <div>๐ฑ ${user.phone}</div>
                        <div>๐ง @${user.telegram}</div>
                        <div class="text-xs mt-2">${new Date(user.created_at).toLocaleDateString('fa-IR')}</div>
                        <!-- ุฒูุงู ุขุฒููู ุจู ุตูุฑุช ุฏุงูุงูฺฉ ุงุถุงูู ุฎูุงูุฏ ุดุฏ -->
                    </div>
                </div>
                <div class="text-right">
                    <span class="inline-block w-3 h-3 rounded-full bg-gray-400" id="status-${user.id}"></span>
                </div>
            </div>
        `;

        userCard.addEventListener('click', () => selectUser(user));
        usersContainer.appendChild(userCard);

        // Check if user has exam results
        checkUserExamStatus(user.id);
    });
}

                // Check if user has exam results
                checkUserExamStatus(user.id);
            });
        }

// Check user exam status
async function checkUserExamStatus(userId) {
    try {
        const { data: examResults } = await supabase
            .from('exam_results')
            .select('*')
            .eq('user_id', userId)
            .single();

        const { data: examGrades } = await supabase
            .from('exam_grades')
            .select('*')
            .eq('user_id', userId)
            .single();

        const statusElement = document.getElementById(`status-${userId}`);
        let statusText = '';
        
        if (examGrades) {
            statusElement.className = 'inline-block w-3 h-3 rounded-full bg-green-500';
            statusText = 'ุชุตุญุญ ุดุฏู';
        } else if (examResults) {
            statusElement.className = 'inline-block w-3 h-3 rounded-full bg-blue-500';
            
            // ุงุถุงูู ฺฉุฑุฏู ุฒูุงู ุขุฒููู ุจู ฺฉุงุฑุช ฺฉุงุฑุจุฑ
            if (examResults.exam_started_at) {
                const examTime = new Date(examResults.exam_started_at);
                statusText = `ุขุฒููู: ${examTime.toLocaleTimeString('fa-IR')}`;
            } else {
                statusText = 'ุขุฒููู ุฏุงุฏู ุดุฏู';
            }
        } else {
            statusElement.className = 'inline-block w-3 h-3 rounded-full bg-yellow-500';
            statusText = 'ุฏุฑ ุญุงู ุขุฒููู';
        }
        
        statusElement.title = statusText;
        
        // ุงุถุงูู ฺฉุฑุฏู ุฒูุงู ุจู ฺฉุงุฑุช ฺฉุงุฑุจุฑ
        const userCard = document.querySelector(`[onclick="selectUser(${JSON.stringify(allUsers.find(u => u.id === userId))})"]`);
        if (userCard && examResults?.exam_started_at) {
            const timeElement = userCard.querySelector('.exam-time') || document.createElement('div');
            timeElement.className = 'exam-time text-xs text-gray-500 mt-1';
            const examTime = new Date(examResults.exam_started_at);
            timeElement.textContent = `ุฒูุงู ุขุฒููู: ${examTime.toLocaleTimeString('fa-IR')}`;
            
            if (!userCard.querySelector('.exam-time')) {
                userCard.querySelector('.text-sm').appendChild(timeElement);
            }
        }
        
    } catch (error) {
        console.error('Error checking user status:', error);
    }
}

        // Select user and load their exam data
        async function selectUser(user) {
            selectedUser = user;
            
            // Update UI
            document.querySelectorAll('.user-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            noUserSelected.classList.add('hidden');
            userExamDetails.classList.remove('hidden');

            // Update user info
            document.getElementById('user-fullname').textContent = user.full_name;
            document.getElementById('user-phone').textContent = user.phone;
            document.getElementById('user-telegram').textContent = user.telegram;
            document.getElementById('user-registered').textContent = new Date(user.created_at).toLocaleDateString('fa-IR');

            // Load user's exam data
            await loadUserExamData(user.id);
        }

// Load user's exam answers and grades
async function loadUserExamData(userId) {
    try {
        questionsContainer.innerHTML = '<div class="text-center py-4"><div class="spinner mx-auto"></div><p>ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ ูพุงุณุฎโูุง...</p></div>';

        // Load exam results
        const { data: examResults, error: resultsError } = await supabase
            .from('exam_results')
            .select('*')
            .eq('user_id', userId)
            .single();

        if (resultsError && resultsError.code !== 'PGRST116') {
            throw resultsError;
        }

        userAnswers = examResults?.answers || Array(54).fill(null);

        // Load existing grades
        const { data: examGrades, error: gradesError } = await supabase
            .from('exam_grades')
            .select('*')
            .eq('user_id', userId)
            .single();

        if (gradesError && gradesError.code !== 'PGRST116') {
            throw gradesError;
        }

        correctedAnswers = examGrades?.corrected_answers || Array(54).fill(null);

        // Update exam status and timing information
        const answeredCount = userAnswers.filter(answer => answer !== null).length;
        const currentScore = correctedAnswers.filter(answer => answer === true).length;

        document.getElementById('answered-count').textContent = answeredCount;
        document.getElementById('unanswered-count').textContent = 54 - answeredCount;
        document.getElementById('current-score').textContent = currentScore;

        // ููุงุด ุฒูุงู ุดุฑูุน ู ูพุงุงู ุขุฒููู
        const examStartedAt = examResults?.exam_started_at;
        const examCompletedAt = examResults?.exam_completed_at;
        
        if (examStartedAt) {
            const startedDate = new Date(examStartedAt);
            document.getElementById('exam-started-at').textContent = 
                startedDate.toLocaleDateString('fa-IR') + ' - ' + 
                startedDate.toLocaleTimeString('fa-IR');
        } else {
            document.getElementById('exam-started-at').textContent = 'ุซุจุช ูุดุฏู';
        }

        if (examCompletedAt) {
            const completedDate = new Date(examCompletedAt);
            document.getElementById('exam-completed-at').textContent = 
                completedDate.toLocaleDateString('fa-IR') + ' - ' + 
                completedDate.toLocaleTimeString('fa-IR');
            
            // ูุญุงุณุจู ูุฏุช ุฒูุงู ุขุฒููู
            if (examStartedAt) {
                const startTime = new Date(examStartedAt);
                const endTime = new Date(examCompletedAt);
                const durationMs = endTime - startTime;
                const durationMinutes = Math.floor(durationMs / (1000 * 60));
                const durationHours = Math.floor(durationMinutes / 60);
                const remainingMinutes = durationMinutes % 60;
                
                let durationText = '';
                if (durationHours > 0) {
                    durationText += `${durationHours} ุณุงุนุช ู `;
                }
                durationText += `${remainingMinutes} ุฏููู`;
                
                document.getElementById('exam-duration').textContent = durationText;
            }
        } else {
            document.getElementById('exam-completed-at').textContent = 'ุฏุฑ ุญุงู ุงูุฌุงู';
            document.getElementById('exam-duration').textContent = 'ุฏุฑ ุญุงู ูุญุงุณุจู';
        }

        const gradingStatus = document.getElementById('grading-status');
        if (examGrades) {
            gradingStatus.textContent = 'ุชุตุญุญ ุดุฏู';
            gradingStatus.className = 'bg-green-100 text-green-800 px-2 py-1 rounded text-xs';
        } else {
            gradingStatus.textContent = 'ุชุตุญุญ ูุดุฏู';
            gradingStatus.className = 'bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs';
        }

        // Display questions and answers
        displayQuestionsAndAnswers();

    } catch (error) {
        console.error('Error loading user exam data:', error);
        alert('ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง ุขุฒููู ฺฉุงุฑุจุฑ');
    }
}

        // Display questions with user answers and grading buttons
        function displayQuestionsAndAnswers() {
            questionsContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = correctedAnswers[index];
                
                const questionElement = document.createElement('div');
                questionElement.className = `question-item ${isCorrect === true ? 'correct-answer' : ''} ${isCorrect === false ? 'incorrect-answer' : ''}`;
                
                let answerContent = '';
                if (question.type === 'multiple') {
                    const selectedOption = userAnswer !== null ? question.options[userAnswer] : 'ูพุงุณุฎ ูุฏุงุฏู';
                    answerContent = `
                        <div class="mt-2">
                            <strong>ูพุงุณุฎ ฺฉุงุฑุจุฑ:</strong>
                            <span class="mr-2 ${userAnswer === null ? 'text-red-500' : ''}">
                                ${selectedOption}
                            </span>
                        </div>
                    `;
                } else {
                    const answerText = userAnswer || 'ูพุงุณุฎ ูุฏุงุฏู';
                    answerContent = `
                        <div class="mt-2">
                            <strong>ูพุงุณุฎ ฺฉุงุฑุจุฑ:</strong>
                            <div class="mt-1 p-2 bg-gray-50 rounded text-sm ${userAnswer === null ? 'text-red-500' : ''}">
                                ${answerText}
                            </div>
                        </div>
                    `;
                }

                questionElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-bold">ุณูุงู ${index + 1}: ${question.text}</h4>
                            ${answerContent}
                        </div>
                        <div class="flex flex-col gap-2 mr-4">
                            <button class="correct-btn" onclick="markAnswer(${index}, true)" ${isCorrect === true ? 'disabled' : ''}>
                                โ ุตุญุญ
                            </button>
                            <button class="incorrect-btn" onclick="markAnswer(${index}, false)" ${isCorrect === false ? 'disabled' : ''}>
                                โ ุบูุท
                            </button>
                        </div>
                    </div>
                    ${isCorrect !== null ? `
                        <div class="mt-2 text-sm ${isCorrect ? 'text-green-600' : 'text-red-600'}">
                            ${isCorrect ? 'โ ูพุงุณุฎ ุตุญุญ ุนูุงูุชโฺฏุฐุงุฑ ุดุฏู' : 'โ ูพุงุณุฎ ุบูุท ุนูุงูุชโฺฏุฐุงุฑ ุดุฏู'}
                        </div>
                    ` : ''}
                `;

                questionsContainer.appendChild(questionElement);
            });
        }

        // Mark answer as correct or incorrect
        function markAnswer(questionIndex, isCorrect) {
            correctedAnswers[questionIndex] = isCorrect;
            
            // Update UI
            const questionElement = questionsContainer.children[questionIndex];
            questionElement.className = `question-item ${isCorrect ? 'correct-answer' : 'incorrect-answer'}`;
            
            // Update buttons
            const buttons = questionElement.querySelectorAll('button');
            buttons[0].disabled = isCorrect;
            buttons[1].disabled = !isCorrect;
            
            // Add status message
            let statusDiv = questionElement.querySelector('.mt-2');
            if (!statusDiv || !statusDiv.className.includes('text-')) {
                statusDiv = document.createElement('div');
                statusDiv.className = `mt-2 text-sm ${isCorrect ? 'text-green-600' : 'text-red-600'}`;
                questionElement.appendChild(statusDiv);
            }
            statusDiv.textContent = isCorrect ? 'โ ูพุงุณุฎ ุตุญุญ ุนูุงูุชโฺฏุฐุงุฑ ุดุฏู' : 'โ ูพุงุณุฎ ุบูุท ุนูุงูุชโฺฏุฐุงุฑ ุดุฏู';
            
            // Update current score
            const currentScore = correctedAnswers.filter(answer => answer === true).length;
            document.getElementById('current-score').textContent = currentScore;
        }

        // Save grades to database
        async function saveGrades() {
            if (!selectedUser) return;

            try {
                saveGradesBtn.disabled = true;
                saveGradesBtn.innerHTML = '<div class="spinner"></div>ุฏุฑ ุญุงู ุฐุฎุฑู...';

                const correctedCount = correctedAnswers.filter(answer => answer !== null).length;
                if (correctedCount === 0) {
                    alert('ูุทูุงู ุญุฏุงูู ฺฉ ุณูุงู ุฑุง ุชุตุญุญ ฺฉูุฏ');
                    return;
                }

                const finalScore = correctedAnswers.filter(answer => answer === true).length;

                const { error } = await supabase
                    .from('exam_grades')
                    .upsert({
                        user_id: selectedUser.id,
                        answers: userAnswers,
                        corrected_answers: correctedAnswers,
                        score: finalScore,
                        max_score: 54,
                        corrected_by: 'Admin',
                        corrected_at: new Date().toISOString()
                    }, {
                        onConflict: 'user_id'
                    });

                if (error) throw error;

                alert(`ููุฑุงุช ฺฉุงุฑุจุฑ ุจุง ููููุช ุฐุฎุฑู ุดุฏ\nููุฑู ููุง: ${finalScore} ุงุฒ 54`);
                
                // Update UI
                document.getElementById('grading-status').textContent = 'ุชุตุญุญ ุดุฏู';
                document.getElementById('grading-status').className = 'bg-green-100 text-green-800 px-2 py-1 rounded text-xs';
                
                // Update user status in list
                checkUserExamStatus(selectedUser.id);

            } catch (error) {
                console.error('Error saving grades:', error);
                alert('ุฎุทุง ุฏุฑ ุฐุฎุฑู ููุฑุงุช');
            } finally {
                saveGradesBtn.disabled = false;
                saveGradesBtn.textContent = 'ุฐุฎุฑู ููุฑุงุช';
            }
        }

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredUsers = allUsers.filter(user => 
                user.full_name.toLowerCase().includes(searchTerm) ||
                user.phone.includes(searchTerm) ||
                user.telegram.toLowerCase().includes(searchTerm)
            );
            displayUsers(filteredUsers);
        });

        // Filter functionality
        document.getElementById('filter-all').addEventListener('click', () => {
            displayUsers(allUsers);
        });

        document.getElementById('filter-not-graded').addEventListener('click', async () => {
            const notGradedUsers = [];
            for (const user of allUsers) {
                const { data: examGrades } = await supabase
                    .from('exam_grades')
                    .select('*')
                    .eq('user_id', user.id)
                    .single();
                
                if (!examGrades) {
                    notGradedUsers.push(user);
                }
            }
            displayUsers(notGradedUsers);
        });

        document.getElementById('filter-graded').addEventListener('click', async () => {
            const gradedUsers = [];
            for (const user of allUsers) {
                const { data: examGrades } = await supabase
                    .from('exam_grades')
                    .select('*')
                    .eq('user_id', user.id)
                    .single();
                
                if (examGrades) {
                    gradedUsers.push(user);
                }
            }
            displayUsers(gradedUsers);
        });

        // Make functions global for onclick events
        window.markAnswer = markAnswer;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadUsers();
            saveGradesBtn.addEventListener('click', saveGrades);
        });
    </script>
</body>
</html>
